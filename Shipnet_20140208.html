<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
	<meta charset="UTF-8">
    <title>KitTest</title>
    
    <script type="text/javascript" src="media/js/jquery-1.10.2.js"></script>
    <script type="text/javascript" src="media/js/jquery-ui-1.10.4.custom.js"></script>
	<script type="text/javascript" src="media/js/jquery.sparkline.js"></script>
    <script type="text/javascript" src="media/js/jquery.dataTables.js"></script>
    
	<script type="text/javascript" src="media/js/underscore.js"></script>
	<!-- <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css"> -->
    <!-- <link rel="stylesheet" href="media/css/smoothness/jquery-ui-1.10.4.custom.css"> -->
    <link rel="stylesheet" href="style.css">
	
<script type="text/javascript">
	$(document).ready(function() {
		setInterval("get_JSON()",1000);
	});
	//var CR1000 = new Object()
	//CR1000.

	/*
	 *  normRand: returns normally distributed random numbers
	 *  http://memory.psych.mun.ca/tech/snippets/random_normal/
	 */
	function normRand(mu, sigma) {
		var x1, x2, rad;
	 
		do {
			x1 = 2 * Math.random() - 1;
			x2 = 2 * Math.random() - 1;
			rad = x1 * x1 + x2 * x2;
		} while(rad >= 1 || rad == 0);
	 
		var c = Math.sqrt(-2 * Math.log(rad) / rad);
		var n = x1 * c;
		return (n * mu) + sigma;
	};
	
	
	
	
    $(function() {
    // When the testform is submitted…
		$("#testform").submit(function() {
			// post the form values via AJAX…
			var postdata = {name: $("#name").val()} ;
			$.post('/submit', postdata, function(data) {
				// and set the title with the result
				$("#title").html(data['title']) ;
			   });
			return false ;
        });
    });

	var json_URL = "http://127.0.0.1:8080/json_sample"
	function get_JSON() {
		$.getJSON( json_URL, function( data ) {
			/* 
			var items = [];
			$.each( data, function( key, val ) {
				items.push( "<li id='" + key + "'>" + key + ": " + val + "</li>" );
			});
			*/
			make_table("#random", data);
		});	
	}

	function format_float( elem, index, array ) { 
		array[index] = parseFloat(elem).toFixed(2); 
	}
	
	var data_change_history = {};	
	var data_history = {};

	function make_table(id, json) {
		if(!$("#live_data_Table").length){
			var table = $("<table>").addClass('data').attr("id","live_data_Table");
			$("#live_data").append(table);
			var thead = $("<thead>");
			table.append(thead);
			thead.html($("<tr><th>Sensor</th><th colspan=2>Change</th><th colspan=2>Value</th></tr>"));
		};
		var table = $("#live_data_Table");
		table.children("tbody").remove();
		var tbody = $("<tbody>");
		table.append(tbody);
	
		$.each( json, function( key, list ) {
			list.forEach(format_float);
			
			if(typeof data_history[key] === "undefined") {
				data_history[key] = new Array();
			}
			data_history[key].push(list[1]);
			if( data_history[key].length > 60 ) data_history[key].shift();

			if(typeof data_change_history[key] === "undefined") {
				data_change_history[key] = new Array();
			}
			data_change_history[key].push(list[0]);
			if( data_change_history[key].length > 60 ) data_change_history[key].shift();

			var row = $("<tr>")
			row.append($("<th></th>").text(key))
			row.append($("<td></td>").addClass("data_cell").text(list[0]))
			row.append($("<td></td>").addClass("inlinebar").text(data_change_history[key].join()))
			row.append($("<td></td>").addClass("data_cell").text(list[1]))
			row.append($("<td></td>").addClass("sparkline_line").text(data_history[key].join()))
			row.append($("<td></td>").addClass("progressbar").progressbar({value:list[1]}))
			tbody.append(row)
		})
		
		$('.inlinebar').sparkline('html', {type: 'bar', barColor: 'red', height: 30, barWidth: 3} ).width(60*3+1);
		$('.sparkline_line').sparkline('html', {height: 30}).width(60*3+1);
		$('.data_cell').width(50)
		//$('.data_bar').progressbar((value='html')
		//$('tr').height(20)
	}
	
	
	
    $(function() {
		
        /** This code runs when everything has been loaded on the page */
        /* Inline sparklines take their values from the contents of the tag */
        $('.inlinesparkline').sparkline(); 

        /* Sparklines can also take their values from the first argument 
        passed to the sparkline() function */
        var myvalues = [10,8,5,7,4,4,1];
        $('.dynamicsparkline').sparkline(myvalues);

        /* The second argument gives options such as chart type */
        $('.dynamicbar').sparkline(myvalues, {type: 'bar', barColor: 'green'} );

        /* Use 'html' instead of an array of values to pass options 
        to a sparkline with data in the tag */
        $('.inlinebar').sparkline('html', {type: 'bar', barColor: 'red'} );
    });

	
</script>
<script>
$(function() {
    $( "#tabs" ).tabs();
});
</script>

</head>




<body>
<h1 id="title">Solar Energy Group</h1>


<div id="main">
	<div id="tabs">
		<ul>
		<li><a href="#live_data">Live Data</a></li>
		<li><a href="#sparkline">Sparklines</a></li>
		<li><a href="#tabs-3">Aenean lacinia</a></li>
		</ul>
		<div id="live_data">

		</div>
		<div id="sparkline">
			<p>
			Inline Sparkline: <span class="inlinesparkline">1,4,4,7,5,9,10</span>.
			</p>
			<p>
			Sparkline with dynamic data: <span class="dynamicsparkline">Loading..</span>
			</p>
			<p>
			Bar chart with dynamic data: <span class="dynamicbar">Loading..</span>
			</p>
			<p>
			Bar chart with inline data: <span class="inlinebar">1,3,4,5,3,5</span>
			</p>
		</div>
		<div id="tabs-3">
			<p>Mauris eleifend est et turpis. Duis id erat. Suspendisse potenti. Aliquam vulputate, pede vel vehicula accumsan, mi neque rutrum erat, eu congue orci lorem eget lorem. Vestibulum non ante. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Fusce sodales. Quisque eu urna vel enim commodo pellentesque. Praesent eu risus hendrerit ligula tempus pretium. Curabitur lorem enim, pretium nec, feugiat nec, luctus a, lacus.</p>
			<p>Duis cursus. Maecenas ligula eros, blandit nec, pharetra at, semper at, magna. Nullam ac lacus. Nulla facilisi. Praesent viverra justo vitae neque. Praesent blandit adipiscing velit. Suspendisse potenti. Donec mattis, pede vel pharetra blandit, magna ligula faucibus eros, id euismod lacus dolor eget odio. Nam scelerisque. Donec non libero sed nulla mattis commodo. Ut sagittis. Donec nisi lectus, feugiat porttitor, tempor ac, tempor vitae, pede. Aenean vehicula velit eu tellus interdum rutrum. Maecenas commodo. Pellentesque nec elit. Fusce in lacus. Vivamus a libero vitae lectus hendrerit hendrerit.</p>
		</div>
	</div>
</div id="main">


</body>
</html>
